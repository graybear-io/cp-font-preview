# Configuration

Customize cp-font-preview behavior and appearance.

## Command-Line Options

### Window Size

Control preview window dimensions:

```bash
cp-font-preview preview --manifest manifest.json --width 1024 --height 768
```

**Defaults:**
- Width: 800 pixels
- Height: 600 pixels

**Recommendations:**
- **Small fonts (10-20 chars)**: 800x600 (default)
- **Medium fonts (50-100 chars)**: 1024x768
- **Large fonts (200+ chars)**: 1600x1200 or larger
- **Emoji fonts**: 1200x900 (larger glyphs need space)

### Watch Mode

Enable automatic reload on file changes:

```bash
cp-font-preview preview --manifest manifest.json --watch
```

**Behavior:**
- Monitors manifest directory
- Detects changes to `.json`, `.pcf`, `.bdf` files
- 500ms debounce to avoid rapid reloads
- Prints reload notifications to terminal

**Use Cases:**
- Iterative font design
- Testing character additions
- Rapid prototyping
- Development workflow

## Display Settings

### Grid Layout

**Hardcoded (not configurable):**
- 16 characters per row
- Automatic row wrapping
- Black background (#000000)
- White text (#FFFFFF)

**Spacing:**
- Characters are automatically spaced based on font metrics
- Fixed-width grid for alignment

### Font Selection

When manifest contains multiple font files:

**Priority order:**
1. First `.pcf` file found
2. First `.bdf` file if no PCF
3. Error if no valid fonts

**To preview different sizes:**
Generate separate manifests or edit manifest to list desired font first.

## Environment Variables

cp-font-preview respects these pygame/SDL environment variables:

### SDL_VIDEODRIVER

Force specific video driver:

```bash
SDL_VIDEODRIVER=x11 cp-font-preview preview --manifest manifest.json
```

**Options:**
- `x11` - X11 (Linux)
- `wayland` - Wayland (Linux)
- `cocoa` - macOS native
- `windows` - Windows native

### SDL_AUDIODRIVER

Disable audio (pygame requirement):

```bash
SDL_AUDIODRIVER=dummy cp-font-preview preview --manifest manifest.json
```

Useful for headless systems or CI environments.

## Manifest Configuration

cp-font-preview reads configuration from manifest JSON files generated by cp-font-gen.

### Required Fields

```json
{
  "font_family": "myfont",
  "output_directory": "/path/to/output",
  "generated_files": ["myfont-16pt.pcf"],
  "characters": "ABC123"
}
```

### Optional Fields

```json
{
  "sizes": [16, 24, 32],
  "formats": ["pcf", "bdf"],
  "character_count": 6,
  "source_font": "/path/to/source.ttf"
}
```

**Note:** These fields are informational and don't affect preview behavior.

## Justfile Configuration

Customize project justfile for your workflow:

### Custom Preview Targets

```just
# Preview your project's font
preview-myproject:
    uv run cp-font-preview preview --manifest ../myproject/fonts/output/manifest.json

# Watch your project
watch-myproject:
    uv run cp-font-preview preview --manifest ../myproject/fonts/output/manifest.json --watch
```

### Custom Paths

```just
# Set default manifest path
MANIFEST := "../cp-font-gen/output/default/manifest.json"

preview:
    uv run cp-font-preview preview --manifest {{MANIFEST}}
```

### Environment Variables

```just
# Disable audio for faster startup
preview-quiet:
    SDL_AUDIODRIVER=dummy uv run cp-font-preview preview --manifest {{MANIFEST}}
```

## Python API (Advanced)

Use cp-font-preview programmatically:

```python
from cp_font_preview.manifest import load_manifest, get_characters, get_font_paths
from cp_font_preview.preview import FontPreview

# Load manifest
manifest_data = load_manifest('path/to/manifest.json')
characters = get_characters(manifest_data)
font_paths = get_font_paths(manifest_data)

# Create preview
font_file = font_paths[0]  # Use first font
font_info = {
    'font_family': manifest_data['font_family'],
    'sizes': manifest_data.get('sizes', []),
    'formats': manifest_data.get('formats', []),
    'character_count': len(characters)
}

preview = FontPreview(
    str(font_file),
    characters,
    font_info,
    width=1024,
    height=768
)

# Run preview
preview.run()
preview.close()
```

### With Watch Mode

```python
from cp_font_preview.watcher import FontWatcher

reload_requested = [False]

def on_change():
    reload_requested[0] = True

def check_reload():
    if reload_requested[0]:
        reload_requested[0] = False
        # Reload manifest and update preview
        return True
    return False

watcher = FontWatcher('path/to/manifest.json', on_change)
watcher.start()

try:
    preview.run(watch_callback=check_reload)
finally:
    watcher.stop()
    preview.close()
```

## Performance Tuning

### Large Fonts

For fonts with 500+ characters:

```bash
# Increase window size
cp-font-preview preview --manifest manifest.json --width 2000 --height 1500

# Disable watch mode (faster)
cp-font-preview preview --manifest manifest.json  # No --watch
```

### Slow Loading

If font loading is slow:

1. **Use PCF instead of BDF** - Binary format loads faster
2. **Reduce character count** - Fewer glyphs = faster load
3. **Close other applications** - Free up memory

### Watch Mode Latency

If reloads are too frequent or slow:

- Debounce is hardcoded to 500ms
- To change, edit `src/cp_font_preview/watcher.py`
- Adjust `DEBOUNCE_SECONDS` constant

## Future Configuration Options

These are not yet implemented but planned:

- Configurable grid columns
- Custom background/foreground colors
- Font smoothing options
- Character filtering (show subset)
- Multiple size comparison view

See [Development](development.md) for contributing these features.

## Next Steps

- **[User Guide](user-guide.md)** - Complete usage documentation
- **[Troubleshooting](troubleshooting.md)** - Fix common issues
- **[Development](development.md)** - Contribute improvements
